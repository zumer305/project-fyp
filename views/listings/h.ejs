
<% layout("/layouts/boiler")%>
<style>
  .travel-box {
    width: 300px;
    margin: 20px auto;
    padding: 20px;
    border-radius: 10px;
    background: #e0f0ff; /* light blue theme */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    font-family: Arial, sans-serif;
  }
  .travel-box h3 {
    text-align: center;
    color: #007acc;
  }
  .travel-box label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  .travel-box select,
  .travel-box input {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 5px;
    border: 1px solid #007acc;
  }
  .travel-box button {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background-color: #007acc;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .travel-box button:hover {
    background-color: #005f99;
  }
  .result {
    margin-top: 10px;
    font-weight: bold;
    color: #005f99;
    text-align: center;
  }
</style>

<body>

<div class="travel-box">
  <h3>ğŸŒ Travel Budget</h3>

  <label for="country">Select Central Asian Country:</label>
  <select id="country">
    <option value="">-- Choose Country --</option>
    <option value="Azerbaijan">Azerbaijan</option>
    <option value="Kazakhstan">Kazakhstan</option>
    <option value="Kyrgyzstan">Kyrgyzstan</option>
    <option value="Tajikistan">Tajikistan</option>
    <option value="Turkmenistan">Turkmenistan</option>
    <option value="Uzbekistan">Uzbekistan</option>
  </select>

  <label for="budget">Enter Budget (USD):</label>
  <input type="number" id="budget" placeholder="e.g. 10000" oninput="showBudget()">

  <div class="result" id="result"></div>

  <!-- Button to go to packages page -->
  <button onclick="goToPackages()">View Packages</button>
</div>


  <h2>ğŸ§  AI Destination Recommendations</h2>
  <div class="grid">
    <div class="card">
      <img src="https://concept.kg/media/redactor/ik.jpg" alt="Issyk-Kul Lake">
      <h3>Issyk-Kul Lake, Kyrgyzstan</h3>
      <p>ğŸ’° $620 / trip</p>
      <p>â­ 4.6 (185 reviews)</p>
      <div class="tags">
        <span>#Cool</span><span>#Mountain</span><span>#CentralAsia</span>
      </div>
      <div class="actions">
        <button class="view">ğŸ‘ï¸ View Details</button>
        <button class="save">â¤ï¸ Save</button>
        <button class="add">ğŸ§³ Add</button>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>ğŸ‘¥ Group Travel Planner</h2>
    <div class="grid">
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/add-user-group-man-man.png"/>
          <h3>Create Group</h3>
        </div>
        <p>Start a new travel group and invite friends via email or code.</p>
        <button id="btn-create-group">â• Create</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/link--v1.png"/>
          <h3>Join Group</h3>
        </div>
        <p>Join a group using an invite code from your friends.</p>
        <button id="btn-join-group">ğŸ”— Join</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-glyphs/30/chat--v1.png"/>
          <h3>Group Chat</h3>
        </div>
        <p>Chat with your group members in real-time.</p>
        <button id="btn-open-chat">ğŸ’¬ Open Chat</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/map.png"/>
          <h3>Shared Itinerary</h3>
        </div>
        <p>View and export your planned group trip itinerary.</p>
        <button id="btn-view-plan">ğŸ—ºï¸ View Plan</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-glyphs/30/money.png"/>
          <h3>Expense Split</h3>
        </div>
        <p>Track spending and calculate balances between members.</p>
        <button id="btn-expense-summary">ğŸ’¸ View Summary</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/marker.png"/>
          <h3>Share Live Location</h3>
        </div>
        <p>Share your real-time location with group members during the trip.</p>
        <button id="btn-share-location">ğŸ“ Share Now</button>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>ğŸ•Œ Faith-Friendly Travel Tools</h2>
    <div class="grid">
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/mosque.png"/>
          <h3>Nearby Mosques</h3>
        </div>
        <p>Find mosques nearby with prayer times and distance info.</p>
        <button id="btn-find-mosques">ğŸ•Œ Find Mosques</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/compass.png"/>
          <h3>Qiblah Direction</h3>
        </div>
        <p>View direction of Qiblah from your current location.</p>
        <button id="btn-show-qiblah">ğŸ•‹ Show Qiblah</button>
      </div>
      <div class="feature-card">
        <div class="icon-title">
          <img src="https://img.icons8.com/ios-filled/50/restaurant.png"/>
          <h3>Halal Food Locator</h3>
        </div>
        <p>Discover nearby halal restaurants and certified food places.</p>
        <button id="btn-find-halal">ğŸ½ï¸ Find Halal</button>
      </div>
    </div>
  </div>
    <!-- ğŸ“ Map Section -->
    <div class="section">
      <h2>Explore on Map</h2>
      <div class="map">
        <iframe 
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2924.361624195853!2d74.6059308!3d42.8746211!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x389ecfbe7c1b17b1%3A0x53dff206c62b9f6a!2sBishkek!5e0!3m2!1sen!2skg!4v1718450000000"
          allowfullscreen="" loading="lazy">
        </iframe>
      </div>
    </div>

    <!-- ğŸ“¡ Scraped Info Section -->
    <div class="section">
      <h2>Live Destination Insights</h2>
      <div class="cards">
        <div class="card">
          <h3>ğŸ’¸ Local Taxi Fares</h3>
          <p>Base fare starts at $1.2 with $0.5/km. Rideshare apps available.</p>
          <a class="view-more" href="#">View More</a>
          <div class="updated-note">Updated automatically</div>
        </div>
        <div class="card">
          <h3>ğŸ“… Festivals & Events</h3>
          <p>Don't miss the "Nowruz Spring Festival" in March with local music and food.</p>
          <a class="view-more" href="#">View More</a>
          <div class="updated-note">Updated automatically</div>
        </div>
        <div class="card">
          <h3>ğŸ¥˜ Famous Food Spots</h3>
          <p>Try "Osh" at Faiza Restaurant or local cafes on Chuy Avenue.</p>
          <a class="view-more" href="#">View More</a>
          <div class="updated-note">Updated automatically</div>
        </div>
        <div class="card">
          <h3>ğŸ’¡ Budgeted Tour Suggestions</h3>
          <p>3-Day Trip: City Tour â†’ Ala Archa Park â†’ Osh Bazaar. Budget under $100.</p>
          <a class="view-more" href="#">View More</a>
          <div class="updated-note">Updated automatically</div>
        </div>
      </div>
    </div>







<button onclick="goToPackages()">View Packages</button>

<script>
const isLoggedIn = <%- JSON.stringify(!!currUser) %>;
function showBudget() {
  const budget = document.getElementById('budget').value;
  const result = document.getElementById('result');
  
  if (budget) {
    if (budget < 5000) {
      result.innerHTML = `<span style="color: #dc3545;">ğŸ’° Budget: $${budget} - Consider increasing for better packages</span>`;
    } else if (budget >= 5000 && budget < 10000) {
      result.innerHTML = `<span style="color: #ffc107;">ğŸ’° Budget: $${budget} - Good for basic packages</span>`;
    } else if (budget >= 10000 && budget < 15000) {
      result.innerHTML = `<span style="color: #28a745;">ğŸ’° Budget: $${budget} - Excellent for premium packages!</span>`;
    } else {
      result.innerHTML = `<span style="color: #28a745;">ğŸ’° Budget: $${budget} - Luxury packages available!</span>`;
    }
  } else {
    result.innerHTML = '';
  }
}

function goToPackages() {
  const country = document.getElementById('country').value;
  const budget = document.getElementById('budget').value;

  if (country && budget) {
    window.location.href = `/packages?country=${country}&budget=${budget}`;
  } else {
    alert('Please select a country and enter your budget first!');
  }
}

// Helpers
async function getCoords() {
  return new Promise((resolve) => {
    if (!navigator.geolocation) return resolve({ lat: null, lon: null });
    navigator.geolocation.getCurrentPosition(
      (pos) => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
      () => resolve({ lat: null, lon: null })
    );
  });
}

// Groups
document.getElementById('btn-create-group').addEventListener('click', async () => {
  if (!isLoggedIn) return window.location.href = '/login';
  const name = prompt('Enter group name:', 'My Trip Group');
  if (!name) return;
  const res = await fetch('/api/groups', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name }) });
  const data = await res.json();
  if (res.ok) {
    alert('Group created: ' + data.group._id);
  } else {
    alert('Error: ' + (data.message || 'Failed'));
  }
});

document.getElementById('btn-join-group').addEventListener('click', async () => {
  if (!isLoggedIn) return window.location.href = '/login';
  const id = prompt('Enter group ID to join:');
  if (!id) return;
  const res = await fetch(`/api/groups/${id}/join`, { method: 'POST' });
  const data = await res.json();
  alert(res.ok ? 'Joined group!' : ('Error: ' + (data.message || 'Failed')));
});

document.getElementById('btn-open-chat').addEventListener('click', async () => {
  if (!isLoggedIn) return window.location.href = '/login';
  const id = prompt('Enter group ID to view messages:');
  if (!id) return;
  const res = await fetch(`/api/groups/${id}/messages`);
  const data = await res.json();
  if (res.ok) {
    alert(`Messages loaded: ${data.messages.length}`);
  } else {
    alert('Error: ' + (data.message || 'Failed'));
  }
});

// Map/Location
document.getElementById('btn-share-location').addEventListener('click', async () => {
  const coords = await getCoords();
  const res = await fetch(`/api/map/nearby?lat=${coords.lat}&lon=${coords.lon}&type=hotel`);
  const data = await res.json();
  alert(res.ok ? `Nearby hotels found: ${data.hotels.length}` : ('Error: ' + (data.message || 'Failed')));
});

// Faith tools
document.getElementById('btn-find-mosques').addEventListener('click', async () => {
  const c = await getCoords();
  const res = await fetch(`/api/faith/mosques?lat=${c.lat}&lon=${c.lon}`);
  const data = await res.json();
  alert(res.ok ? `Mosques: ${data.items.map(i=>i.name).join(', ')}` : ('Error: ' + (data.message || 'Failed')));
});

document.getElementById('btn-show-qiblah').addEventListener('click', async () => {
  const c = await getCoords();
  const res = await fetch(`/api/faith/qiblah?lat=${c.lat}&lon=${c.lon}`);
  const data = await res.json();
  alert(res.ok ? `Qiblah angle: ${data.angle}Â°` : ('Error: ' + (data.message || 'Failed')));
});

document.getElementById('btn-find-halal').addEventListener('click', async () => {
  const c = await getCoords();
  const res = await fetch(`/api/faith/halal?lat=${c.lat}&lon=${c.lon}`);
  const data = await res.json();
  alert(res.ok ? `Halal places: ${data.items.map(i=>i.name).join(', ')}` : ('Error: ' + (data.message || 'Failed')));
});
</script>
</script>

</body>

